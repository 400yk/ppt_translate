# Deploying Flask Backend to Heroku

This guide will help you deploy your Flask backend (in the `backend` folder) to Heroku using the Heroku CLI on Windows.

---

## 1. Install the Heroku CLI (Windows)

1. Go to the [Heroku CLI download page](https://devcenter.heroku.com/articles/heroku-cli#download-and-install).
2. Download the Windows 64-bit installer (`heroku-x64.exe`).
3. Run the installer and follow the prompts.
4. After installation, open a new PowerShell window and run:
   ```sh
   heroku --version
   ```
   You should see the Heroku CLI version output.

---

## 2. Prepare Your Backend for Deployment

Make sure your `backend` folder contains:
- `Procfile` with:
  ```
  web: gunicorn app:app
  ```
- `requirements.txt` (with `gunicorn` and `Flask-Migrate` included)
- `runtime.txt` (e.g., `python-3.11.7`)

---

## 3. Deploy to Heroku

### a. Initialize Git (if not already done)
```sh
cd backend
git init
```

### b. Commit Your Code
```sh
git add .
git commit -m "Initial backend commit"
```

### c. Create a New Heroku App
```sh
heroku create your-app-name-backend
```
Replace `your-app-name-backend` with a unique name.

### d. Add Heroku Remote (if not automatically added)
```sh
heroku git:remote -a your-app-name-backend
```

### e. Push to Heroku
```sh
git push heroku master
```
Or, if your branch is `main`:
```sh
git push heroku main
```

---

## 4. Set Environment Variables
Set any required environment variables (e.g., API keys):
```sh
heroku config:set GEMINI_API_KEY=your_api_key -a your-app-name-backend
```
Add any other variables your backend needs.

**Important:**
- Set `FLASK_API_URL` to your Heroku backend URL in production, **not** to `localhost`. For example:
  ```
  heroku config:set FLASK_API_URL=https://your-app-name-backend.herokuapp.com -a your-app-name-backend
  ```
- This ensures that any URLs generated by your backend (e.g., for Stripe redirects or API responses) are correct for users accessing your deployed app.

---

## 5. Update Frontend API URL
After deployment, update your frontend's `API_URL` to point to your Heroku backend:
```sh
heroku config:set API_URL=https://your-app-name-backend.herokuapp.com -a your-frontend-app-name
```
Make sure your frontend is **not** using `localhost` for the backend in production.

---

## 6. Run Database Migrations on Heroku

If you are in your backend repo and have already set the Heroku remote, you can simply run:
```sh
heroku run bash
```
This will open a shell in your Heroku dyno.

Then, in the Heroku shell, run:
```sh
flask db upgrade
```
If you see an error about `FLASK_APP` not being set, try:
```sh
export FLASK_APP=app.py
flask db upgrade
```

---

## 7. Verify Deployment
Visit `https://your-app-name-backend.herokuapp.com` in your browser to check if your backend is running.

---

## Troubleshooting
- Make sure all dependencies are in `requirements.txt`.
- Check Heroku logs with:
  ```sh
  heroku logs --tail
  ```
- Ensure your backend is listening on `0.0.0.0` and the port provided by Heroku (already handled in `app.py`).
- If your frontend cannot reach the backend, double-check that both `FLASK_API_URL` (backend) and `API_URL` (frontend) are set to the correct Heroku backend URL, **not** localhost.

---

Happy deploying! 